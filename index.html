import React, { useState, useEffect } from 'react';
import { Calendar, CheckCircle, Circle, Plus, Settings, Target, Clock, Flag, Home, List, BarChart3, User, Search, Filter, ChevronLeft, ChevronRight } from 'lucide-react';

const ProductivityApp = () => {
  const [activeTab, setActiveTab] = useState('today');
  const [selectedDate, setSelectedDate] = useState(new Date());
  const [tasks, setTasks] = useState([
    { id: 1, title: 'Morning Run', time: '07:00', completed: false, category: 'health', priority: 'low', date: '2024-09-05' },
    { id: 2, title: 'Interview Mr. Li', time: '09:00', completed: false, category: 'work', priority: 'high', date: '2024-09-05' },
    { id: 3, title: 'Prepare Work Report', time: '13:00', completed: false, category: 'work', priority: 'high', date: '2024-09-05' },
    { id: 4, title: 'Evening Reading', time: '22:00', completed: false, category: 'personal', priority: 'low', date: '2024-09-05' },
    { id: 5, title: 'Check Work Emails', time: '', completed: false, category: 'work', priority: 'medium', date: '2024-09-06' },
    { id: 6, title: 'Attend Meeting', time: '', completed: false, category: 'work', priority: 'high', date: '2024-09-06' },
    { id: 7, title: 'Pick Up Package', time: '', completed: false, category: 'personal', priority: 'low', date: '2024-09-06' },
  ]);

  const [habits, setHabits] = useState([
    { id: 1, name: 'Run', icon: 'üèÉ', streak: 64, missed: 0, completed: [true, true, true, true, false, false, true] },
    { id: 2, name: 'Read', icon: 'üìö', streak: 26, missed: 13, completed: [true, true, true, true, true, false, true] },
    { id: 3, name: 'Eat Breakfast', icon: 'üç≥', streak: 102, missed: 46, completed: [true, true, true, true, true, true, true] },
    { id: 4, name: 'Eat Fruits', icon: 'üçé', streak: 79, missed: 1, completed: [true, true, true, true, true, true, true] },
    { id: 5, name: 'Eat Veggies', icon: 'ü•ï', streak: 187, missed: 82, completed: [true, true, true, true, true, true, true] },
    { id: 6, name: 'Exercise', icon: 'üí™', streak: 48, missed: 36, completed: [true, true, true, true, true, true, true] },
  ]);

  const [projects, setProjects] = useState([
    { id: 1, name: 'Product Launch', tasks: ['Project Kickoff', 'Submit Product', 'Follow Up on Feedback'], color: 'bg-blue-500' },
    { id: 2, name: 'Design System', tasks: ['Design Research', 'UI Design', 'Design Review'], color: 'bg-cyan-500' },
    { id: 3, name: 'Development', tasks: ['Technical Research', 'Develop Project'], color: 'bg-green-500' },
    { id: 4, name: 'Operations', tasks: ['Prepare Operations', 'Event Planning'], color: 'bg-red-500' },
    { id: 5, name: 'Testing', tasks: ['Test Plan', 'Test Case Design'], color: 'bg-yellow-500' },
  ]);

  const [currentTime, setCurrentTime] = useState(new Date());

  useEffect(() => {
    const timer = setInterval(() => {
      setCurrentTime(new Date());
    }, 1000);
    return () => clearInterval(timer);
  }, []);

  const formatTime = (date) => {
    return date.toLocaleTimeString('en-US', { 
      hour12: false, 
      hour: '2-digit', 
      minute: '2-digit' 
    });
  };

  const formatDate = (date) => {
    return date.toLocaleDateString('en-US', { 
      weekday: 'short',
      month: 'short',
      day: 'numeric'
    });
  };

  const toggleTask = (id) => {
    setTasks(tasks.map(task => 
      task.id === id ? { ...task, completed: !task.completed } : task
    ));
  };

  const toggleHabit = (habitId, dayIndex) => {
    setHabits(habits.map(habit => {
      if (habit.id === habitId) {
        const newCompleted = [...habit.completed];
        newCompleted[dayIndex] = !newCompleted[dayIndex];
        return { ...habit, completed: newCompleted };
      }
      return habit;
    }));
  };

  const getTodayTasks = () => {
    const today = new Date().toISOString().split('T')[0];
    return tasks.filter(task => task.date === today || task.date === '2024-09-05');
  };

  const getUpcomingTasks = () => {
    const today = new Date().toISOString().split('T')[0];
    return tasks.filter(task => task.date > today || task.date === '2024-09-06');
  };

  const getPriorityColor = (priority) => {
    switch (priority) {
      case 'high': return 'text-red-500';
      case 'medium': return 'text-orange-500';
      case 'low': return 'text-green-500';
      default: return 'text-gray-500';
    }
  };

  const getCategoryColor = (category) => {
    switch (category) {
      case 'work': return 'bg-blue-100 text-blue-800';
      case 'personal': return 'bg-green-100 text-green-800';
      case 'health': return 'bg-purple-100 text-purple-800';
      default: return 'bg-gray-100 text-gray-800';
    }
  };

  const renderTodayView = () => (
    <div className="space-y-6">
      {/* Digital Clock */}
      <div className="bg-gray-900 text-white p-6 rounded-2xl">
        <div className="flex items-center justify-between">
          <div>
            <div className="text-4xl font-bold font-mono">{formatTime(currentTime)}</div>
            <div className="text-gray-400 mt-1">{formatDate(currentTime)}</div>
          </div>
          <div className="text-right">
            <div className="w-12 h-12 bg-red-500 rounded-lg flex items-center justify-center mb-2">
              <span className="text-white text-xl">üçé</span>
            </div>
            <div className="text-sm text-gray-400">MON 10/14</div>
          </div>
        </div>
      </div>

      {/* Today's Tasks */}
      <div className="bg-white rounded-2xl p-6 shadow-sm">
        <div className="flex items-center justify-between mb-4">
          <h2 className="text-xl font-bold">Today's Tasks</h2>
          <span className="text-gray-500 text-sm">{getTodayTasks().length} tasks</span>
        </div>
        <div className="space-y-3">
          {getTodayTasks().map(task => (
            <div key={task.id} className="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
              <button onClick={() => toggleTask(task.id)}>
                {task.completed ? (
                  <CheckCircle className="w-5 h-5 text-green-500" />
                ) : (
                  <Circle className="w-5 h-5 text-gray-400" />
                )}
              </button>
              <div className="flex-1">
                <div className={`font-medium ${task.completed ? 'line-through text-gray-500' : ''}`}>
                  {task.title}
                </div>
                <div className="flex items-center space-x-2 mt-1">
                  {task.time && (
                    <span className="text-sm text-gray-500">{task.time}</span>
                  )}
                  <span className={`text-xs px-2 py-1 rounded-full ${getCategoryColor(task.category)}`}>
                    {task.category}
                  </span>
                </div>
              </div>
              <Flag className={`w-4 h-4 ${getPriorityColor(task.priority)}`} />
            </div>
          ))}
        </div>
      </div>

      {/* Quick Stats */}
      <div className="grid grid-cols-2 gap-4">
        <div className="bg-white rounded-2xl p-4 shadow-sm">
          <div className="text-2xl font-bold text-blue-600">
            {tasks.filter(t => t.completed).length}
          </div>
          <div className="text-sm text-gray-600">Completed Today</div>
        </div>
        <div className="bg-white rounded-2xl p-4 shadow-sm">
          <div className="text-2xl font-bold text-green-600">
            {habits.filter(h => h.completed[4]).length}
          </div>
          <div className="text-sm text-gray-600">Habits Done</div>
        </div>
      </div>
    </div>
  );

  const renderTasksView = () => (
    <div className="space-y-6">
      {/* Eisenhower Matrix */}
      <div className="bg-white rounded-2xl p-6 shadow-sm">
        <h2 className="text-xl font-bold mb-4">Priority Matrix</h2>
        <div className="grid grid-cols-2 gap-4">
          <div className="bg-red-50 p-4 rounded-lg">
            <div className="flex items-center space-x-2 mb-3">
              <div className="w-3 h-3 bg-red-500 rounded-full"></div>
              <span className="text-sm font-medium text-red-700">Urgent & Important</span>
            </div>
            <div className="space-y-2">
              <div className="flex items-center space-x-2">
                <Circle className="w-4 h-4 text-gray-400" />
                <span className="text-sm">Prep Work Report</span>
              </div>
              <div className="flex items-center space-x-2">
                <Circle className="w-4 h-4 text-gray-400" />
                <span className="text-sm">Join Project Meeting</span>
              </div>
            </div>
          </div>
          <div className="bg-yellow-50 p-4 rounded-lg">
            <div className="flex items-center space-x-2 mb-3">
              <div className="w-3 h-3 bg-yellow-500 rounded-full"></div>
              <span className="text-sm font-medium text-yellow-700">Not Urgent & Important</span>
            </div>
            <div className="space-y-2">
              <div className="flex items-center space-x-2">
                <Circle className="w-4 h-4 text-gray-400" />
                <span className="text-sm">Create Work Plan</span>
              </div>
              <div className="flex items-center space-x-2">
                <Circle className="w-4 h-4 text-gray-400" />
                <span className="text-sm">Attend Weekly Meeting</span>
              </div>
            </div>
          </div>
          <div className="bg-blue-50 p-4 rounded-lg">
            <div className="flex items-center space-x-2 mb-3">
              <div className="w-3 h-3 bg-blue-500 rounded-full"></div>
              <span className="text-sm font-medium text-blue-700">Urgent & Unimportant</span>
            </div>
            <div className="space-y-2">
              <div className="flex items-center space-x-2">
                <Circle className="w-4 h-4 text-gray-400" />
                <span className="text-sm">Respond to Client Calls</span>
              </div>
              <div className="flex items-center space-x-2">
                <Circle className="w-4 h-4 text-gray-400" />
                <span className="text-sm">Check Work Emails</span>
              </div>
            </div>
          </div>
          <div className="bg-green-50 p-4 rounded-lg">
            <div className="flex items-center space-x-2 mb-3">
              <div className="w-3 h-3 bg-green-500 rounded-full"></div>
              <span className="text-sm font-medium text-green-700">Not Urgent & Unimportant</span>
            </div>
            <div className="space-y-2">
              <div className="flex items-center space-x-2">
                <Circle className="w-4 h-4 text-gray-400" />
                <span className="text-sm">Morning Run</span>
              </div>
              <div className="flex items-center space-x-2">
                <Circle className="w-4 h-4 text-gray-400" />
                <span className="text-sm">Book a Flight</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Task Categories */}
      <div className="bg-white rounded-2xl p-6 shadow-sm">
        <h2 className="text-xl font-bold mb-4">Task Categories</h2>
        <div className="grid grid-cols-3 gap-4">
          <div className="text-center p-4 bg-blue-50 rounded-lg">
            <div className="text-2xl font-bold text-blue-600">91</div>
            <div className="text-sm text-gray-600">Work Tasks</div>
          </div>
          <div className="text-center p-4 bg-green-50 rounded-lg">
            <div className="text-2xl font-bold text-green-600">37</div>
            <div className="text-sm text-gray-600">Personal</div>
          </div>
          <div className="text-center p-4 bg-purple-50 rounded-lg">
            <div className="text-2xl font-bold text-purple-600">14</div>
            <div className="text-sm text-gray-600">Health</div>
          </div>
        </div>
      </div>
    </div>
  );

  const renderHabitsView = () => (
    <div className="space-y-6">
      <div className="bg-white rounded-2xl p-6 shadow-sm">
        <h2 className="text-xl font-bold mb-4">Weekly Habits</h2>
        <div className="space-y-4">
          {habits.map(habit => (
            <div key={habit.id} className="border-b border-gray-100 pb-4 last:border-0">
              <div className="flex items-center justify-between mb-2">
                <div className="flex items-center space-x-3">
                  <span className="text-2xl">{habit.icon}</span>
                  <div>
                    <div className="font-medium">{habit.name}</div>
                    <div className="text-sm text-gray-500">
                      üî• {habit.streak} Days ‚Ä¢ üíî {habit.missed} Days
                    </div>
                  </div>
                </div>
                <CheckCircle className="w-5 h-5 text-green-500" />
              </div>
              <div className="flex space-x-2">
                {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map((day, index) => (
                  <button
                    key={index}
                    onClick={() => toggleHabit(habit.id, index)}
                    className={`w-8 h-8 rounded-full text-xs font-medium ${
                      habit.completed[index] 
                        ? 'bg-blue-500 text-white' 
                        : 'bg-gray-200 text-gray-600'
                    }`}
                  >
                    {day[0]}
                  </button>
                ))}
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );

  const renderCalendarView = () => (
    <div className="space-y-6">
      <div className="bg-white rounded-2xl p-6 shadow-sm">
        <div className="flex items-center justify-between mb-4">
          <h2 className="text-xl font-bold">September 2024</h2>
          <div className="flex items-center space-x-2">
            <button className="p-2 hover:bg-gray-100 rounded-lg">
              <ChevronLeft className="w-5 h-5" />
            </button>
            <button className="p-2 hover:bg-gray-100 rounded-lg">
              <ChevronRight className="w-5 h-5" />
            </button>
          </div>
        </div>
        
        <div className="grid grid-cols-7 gap-1 mb-4">
          {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
            <div key={day} className="text-center text-sm font-medium text-gray-500 py-2">
              {day}
            </div>
          ))}
        </div>
        
        <div className="grid grid-cols-7 gap-1">
          {Array.from({ length: 35 }, (_, i) => {
            const date = i - 2; // Start from 1st (adjusting for Sunday start)
            const isToday = date === 5;
            const hasEvents = [3, 5, 6, 8, 12, 14, 21].includes(date);
            
            return (
              <div
                key={i}
                className={`h-12 flex items-center justify-center text-sm relative ${
                  date < 1 || date > 30 
                    ? 'text-gray-300' 
                    : isToday 
                      ? 'bg-blue-500 text-white rounded-lg font-bold' 
                      : 'hover:bg-gray-100 rounded-lg'
                }`}
              >
                {date > 0 && date <= 30 && date}
                {hasEvents && (
                  <div className="absolute bottom-1 w-1 h-1 bg-blue-500 rounded-full"></div>
                )}
              </div>
            );
          })}
        </div>
      </div>

      {/* Upcoming Events */}
      <div className="bg-white rounded-2xl p-6 shadow-sm">
        <h3 className="text-lg font-bold mb-4">Upcoming Events</h3>
        <div className="space-y-3">
          <div className="flex items-center space-x-3 p-3 bg-blue-50 rounded-lg">
            <div className="w-3 h-3 bg-blue-500 rounded-full"></div>
            <div>
              <div className="font-medium">Interview Mr. Li</div>
              <div className="text-sm text-gray-500">Sep 5 ‚Ä¢ 09:00</div>
            </div>
          </div>
          <div className="flex items-center space-x-3 p-3 bg-green-50 rounded-lg">
            <div className="w-3 h-3 bg-green-500 rounded-full"></div>
            <div>
              <div className="font-medium">Prepare Work Report</div>
              <div className="text-sm text-gray-500">Sep 5 ‚Ä¢ 13:00</div>
            </div>
          </div>
          <div className="flex items-center space-x-3 p-3 bg-purple-50 rounded-lg">
            <div className="w-3 h-3 bg-purple-500 rounded-full"></div>
            <div>
              <div className="font-medium">Attend Meeting</div>
              <div className="text-sm text-gray-500">Sep 6 ‚Ä¢ All Day</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );

  const renderProjectsView = () => (
    <div className="space-y-6">
      <div className="bg-white rounded-2xl p-6 shadow-sm">
        <h2 className="text-xl font-bold mb-4">Project Timeline</h2>
        <div className="space-y-4">
          {projects.map(project => (
            <div key={project.id} className="border-l-4 border-blue-500 pl-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center space-x-3">
                  <div className={`w-3 h-3 rounded-full ${project.color}`}></div>
                  <span className="font-medium">{project.name}</span>
                </div>
                <ChevronRight className="w-4 h-4 text-gray-400" />
              </div>
              <div className="mt-2 space-y-1">
                {project.tasks.map((task, index) => (
                  <div key={index} className="text-sm text-gray-600 pl-6">
                    ‚Ä¢ {task}
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Project Stats */}
      <div className="grid grid-cols-2 gap-4">
        <div className="bg-white rounded-2xl p-4 shadow-sm">
          <div className="text-2xl font-bold text-blue-600">5</div>
          <div className="text-sm text-gray-600">Active Projects</div>
        </div>
        <div className="bg-white rounded-2xl p-4 shadow-sm">
          <div className="text-2xl font-bold text-green-600">23</div>
          <div className="text-sm text-gray-600">Tasks Completed</div>
        </div>
      </div>
    </div>
  );

  const renderContent = () => {
    switch (activeTab) {
      case 'today': return renderTodayView();
      case 'tasks': return renderTasksView();
      case 'habits': return renderHabitsView();
      case 'calendar': return renderCalendarView();
      case 'projects': return renderProjectsView();
      default: return renderTodayView();
    }
  };

  return (
    <div className="max-w-md mx-auto bg-gray-50 min-h-screen">
      {/* Header */}
      <div className="bg-white px-6 py-4 shadow-sm">
        <div className="flex items-center justify-between">
          <div className="flex items-center space-x-3">
            <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
              <span className="text-white font-bold">P</span>
            </div>
            <div>
              <h1 className="text-lg font-bold">Productivity Hub</h1>
              <p className="text-sm text-gray-500">Stay organized & focused</p>
            </div>
          </div>
          <div className="flex items-center space-x-2">
            <Search className="w-5 h-5 text-gray-400" />
            <Settings className="w-5 h-5 text-gray-400" />
          </div>
        </div>
      </div>

      {/* Content */}
      <div className="p-6">
        {renderContent()}
      </div>

      {/* Bottom Navigation */}
      <div className="fixed bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-md bg-white border-t border-gray-200">
        <div className="flex">
          <button
            onClick={() => setActiveTab('today')}
            className={`flex-1 flex flex-col items-center py-3 ${
              activeTab === 'today' ? 'text-blue-500' : 'text-gray-400'
            }`}
          >
            <Home className="w-5 h-5 mb-1" />
            <span className="text-xs">Today</span>
          </button>
          <button
            onClick={() => setActiveTab('tasks')}
            className={`flex-1 flex flex-col items-center py-3 ${
              activeTab === 'tasks' ? 'text-blue-500' : 'text-gray-400'
            }`}
          >
            <List className="w-5 h-5 mb-1" />
            <span className="text-xs">Tasks</span>
          </button>
          <button
            onClick={() => setActiveTab('habits')}
            className={`flex-1 flex flex-col items-center py-3 ${
              activeTab === 'habits' ? 'text-blue-500' : 'text-gray-400'
            }`}
          >
            <Target className="w-5 h-5 mb-1" />
            <span className="text-xs">Habits</span>
          </button>
          <button
            onClick={() => setActiveTab('calendar')}
            className={`flex-1 flex flex-col items-center py-3 ${
              activeTab === 'calendar' ? 'text-blue-500' : 'text-gray-400'
            }`}
          >
            <Calendar className="w-5 h-5 mb-1" />
            <span className="text-xs">Calendar</span>
          </button>
          <button
            onClick={() => setActiveTab('projects')}
            className={`flex-1 flex flex-col items-center py-3 ${
              activeTab === 'projects' ? 'text-blue-500' : 'text-gray-400'
            }`}
          >
            <BarChart3 className="w-5 h-5 mb-1" />
            <span className="text-xs">Projects</span>
          </button>
        </div>
      </div>
    </div>
  );
};

export default ProductivityApp;
